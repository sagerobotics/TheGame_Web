<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Ava & Alyssa's Adventure â€” Game Select</title>
  <link rel="stylesheet" href="sagestyle.css" />
</head>
<body>
  <!-- Title Screen -->
  <div id="titleScreen">
    <!-- âœ… Top-right thank-you section -->
    <div id="thankYouContainer">
      <h2 id="thankYouText">Thank you for supporting us!</h2>
      <a href="https://www.waywoodms.com/" target="_blank" rel="noopener" id="waywoodLink">
        <img id="waywoodLogo" src="/Assets/Images/waywood.png" alt="Waywood Logo" />
        <span class="tooltipText">Visit Waywood Mississippi</span>
      </a>
      <a href="https://www.facebook.com/sagerobots/" target="_blank" rel="noopener" id="sageLink">
        <img id="sagelogo" src="/Assets/Images/Sagelogo.png" alt="Sage Logo" />
        <span class="tooltipText">Visit Sage Robotics on facebook</span>
      </a>
    </div>

    <!-- Main Title -->
    <img id="titleImage" src="Assets/Images/titleprime.png" alt="Title Logo" />

    <div class="charSelect">
      <button class="charBtn" data-game="JavaCode/frogger.js">ğŸ¸ Play Frogger</button>
      <button class="charBtn" data-game="JavaCode/game.js">ğŸ® Adventure Girl (In Development)</button>
      <button class="charBtn" data-game="JavaCode/spaceinvaders.js">â­ Space Invaders</button>
    </div>
  </div>

  <!-- Game Canvas -->
  <canvas id="game" width="800" height="775"></canvas>

  <!-- Audio -->
  <audio id="coinSound" src="/Assets/Music/coin.wav" preload="auto"></audio>
  <audio id="bgMusic" src="/Assets/Music/thememusic.mp3" loop></audio>

  <!-- DPad -->
  <div id="dpad">
    <div></div>
    <div class="btn" data-key="ArrowUp">â¬†ï¸</div>
    <div></div>
    <div class="btn" data-key="ArrowLeft">â¬…ï¸</div>
    <div></div>
    <div class="btn" data-key="ArrowRight">â¡ï¸</div>
  </div>

  <!-- Action Button -->
  <div id="actionBtn">ğŸ…°ï¸</div>

  <!-- Return Button -->
  <button id="returnBtn">â¬…ï¸ Return to Menu</button>

  <script>
    // --- Global Variables ---
    window.selectedCharacter = null;
    let activeScript = null;
    const bgMusic = document.getElementById("bgMusic");

    // --- Play Background Music Safely ---
    function playMusic() {
      bgMusic.volume = 0.5;
      bgMusic.play().catch(err => console.warn("âš ï¸ Audio playback blocked until user action:", err));
    }

    // --- Stop Background Music ---
    function stopMusic() {
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }

    // --- Load external JS dynamically ---
    function loadScript(file) {
      if (activeScript) activeScript.remove();
      const script = document.createElement("script");
      script.src = file + "?v=" + Date.now();
      script.onload = () => console.log(file + " loaded âœ…");
      script.onerror = () => console.error("Failed to load " + file);
      document.body.appendChild(script);
      activeScript = script;
    }

    // --- Return to menu ---
    window.returnToMenu = function() {
      stopMusic(); // âœ… stop background music when leaving game
      window.location.reload();
      if (activeScript) activeScript.remove();
      document.getElementById("titleScreen").style.display = "flex";
      document.getElementById("returnBtn").style.display = "none";
      const ctx = document.getElementById("game").getContext("2d");
      ctx.clearRect(0, 0, 800, 775);
    };

    // --- Menu Buttons ---
    document.querySelectorAll(".charBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        const file = btn.getAttribute("data-game");
        document.getElementById("titleScreen").style.display = "none";
        document.getElementById("returnBtn").style.display = "block";
        loadScript(file);

        // âœ… Play music ONLY when a game starts
        playMusic();
      });
    });

    // --- Return Button ---
    document.getElementById("returnBtn").addEventListener("click", window.returnToMenu);

    // --- Action Button (Triggers Spacebar) ---
    const actionBtn = document.getElementById("actionBtn");
    const triggerSpace = () => {
      const spaceEvent = new KeyboardEvent("keydown", { key: " " });
      document.dispatchEvent(spaceEvent);
    };
    actionBtn.addEventListener("click", triggerSpace);
    actionBtn.addEventListener("touchstart", e => {
      e.preventDefault();
      triggerSpace();
    }, { passive: false });

    // --- Optional: Unlock Audio Context ---
    window.addEventListener("pointerdown", () => {
      bgMusic.play().then(() => {
        bgMusic.pause();
        bgMusic.currentTime = 0;
      }).catch(() => {});
    }, { once: true });
  </script>
</body>
</html>
